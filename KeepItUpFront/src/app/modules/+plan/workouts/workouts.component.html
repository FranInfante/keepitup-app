<!-- Workout Details Modal -->
<div
  *ngIf="selectedWorkout"
  class="modal-backdrop"
  (click)="closeWorkoutDetails()"
>
  <div class="modal-content" (click)="$event.stopPropagation()">
    <button
      class="btn-close btn-close-white position-absolute top-0 end-0"
      (click)="closeWorkoutDetails()"
    ></button>
    <div class="workout-details-content text-center">
      <h4
        class="mb-3 custom-heading"
        contenteditable="true"
        (blur)="updateWorkoutName()"
        (keydown)="onKeyDown($event, 'workout')"
      >
        {{ selectedWorkout.name }}
      </h4>

      <!-- Drag and drop list for exercises -->
      <div class="exercises">
        <ul
          #exerciseList
          class="list-unstyled"
          cdkDropList
          (cdkDropListDropped)="dropExercise($event)"
        >
          <li
            *ngFor="
              let exercise of selectedWorkout.workoutExercises;
              let i = index
            "
            class="d-flex justify-content-between align-items-center mb-2 position-relative bg-dark pt-1 px-2 rounded"
            cdkDrag
          >
            <span class="exercise-name">{{ exercise?.exerciseName }}</span>
            <button
              class="btn btn-sm delete-btn"
              (click)="deleteExercise(exercise.id!)"
            >
              <img [src]="DeleteIcon" alt="DeleteIcon" />
            </button>
          </li>
        </ul>
        <ng-template #noExercises>
          <p>No exercises available for this workout.</p>
        </ng-template>
        <div class="add-exercise-container"></div>
      </div>

      <!-- <div class="d-flex justify-content-between align-items-center">
        <button
          class="btn btn-primary btn-lg"
          type="button"
          (click)="openExercisePickerModal()"
        >
          <img class="pluss" [src]="PlusSignIcon" alt="PlusSignIcon" />
        </button>
        <button (click)="goToLogPage()"
          class="btn btn-success btn-lg"
          type="button"
        >
          <img class="pluss" [src]="PlayButton" alt="PlayButton" />
        </button>
      </div> -->
    </div>
  </div>
</div>

<!-- Workouts List -->
<div [ngClass]="{ 'content-to-blur': selectedWorkout }">
  <div class="container">
    <div class="row mt-3">
      <ng-container *ngIf="workouts && workouts.length > 0; else noWorkouts">
        <div
          cdkDropList
          cdkDropListOrientation="vertical"
          class="example-list"
          (cdkDropListDropped)="drop($event)"
        >
          <div
            *ngFor="let workout of workouts; let i = index"
            class="workout-box d-flex justify-content-center align-items-center mt-3"
            (click)="showWorkoutDetails(workout)"
            [cdkDragData]="workout"
            cdkDrag
            [cdkDragDisabled]="!isEditing"
            [ngClass]="isEditing ? 'editing-bg' : 'bg-dark'"
          >
            <button
              *ngIf="isEditing"
              class="btn-close"
              (click)="
                markWorkoutForDeletion(workout); $event.stopPropagation()
              "
            ></button>
            <h5>{{ workout.name }}</h5>
          </div>
        </div>
      </ng-container>

      <button *ngIf="isEditing" id="bottone5" (click)="saveReorderedWorkouts()">
        Save changes
      </button>

      <div
        class="d-flex justify-content-end mt-3 mb-4"
        data-bs-toggle="modal"
        data-bs-target="#exampleModal"
      >
        <div class="add-box d-flex justify-content-center align-items-center">
          <h4 class="text-primary">
            <img [src]="PlusSignIcon" alt="PlusSignIcon" />
          </h4>
        </div>
      </div>
      <ng-template #noWorkouts>
        <div>
          <p class="text-center px-3">No workouts available for this plan.</p>
        </div>
      </ng-template>
    </div>
  </div>
</div>

<!-- Workout Creation Modal -->
<div
  class="modal fade"
  id="exampleModal"
  tabindex="-1"
  aria-labelledby="exampleModalLabel"
>
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-body">
        <!-- <form [formGroup]="workoutForm" (ngSubmit)="createWorkout()
        "> -->
        <form [formGroup]="workoutForm">
          <div class="mb-3">
            <label for="workout-name" class="col-form-label"
              >Workout Name:</label
            >
            <input
              type="text"
              class="form-control"
              id="workout-name"
              formControlName="workoutName"
              maxlength="20"
              required
            />
            <div
              *ngIf="
                workoutForm.get('workoutName')?.invalid &&
                workoutForm.get('workoutName')?.touched
              "
              class="text-danger"
            >
              <div *ngIf="workoutForm.get('workoutName')?.errors?.['required']">
                Workout name is required.
              </div>
              <div
                *ngIf="workoutForm.get('workoutName')?.errors?.['maxlength']"
              >
                Workout name cannot exceed 20 characters.
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Close
            </button>
            <button
              type="submit"
              class="btn btn-primary"
              data-bs-dismiss="modal"
              [disabled]="workoutForm.invalid"
            >
              Create Workout
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
